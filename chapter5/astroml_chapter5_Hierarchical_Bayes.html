

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Hierarchical Bayes Example &#8212; AstroML Interactive Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter5/astroml_chapter5_Hierarchical_Bayes';</script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 6: Searching for Structure in Point Data" href="../chapter6/README.html" />
    <link rel="prev" title="Approximate Bayesian Computation Example" href="astroml_chapter5_Approximate_Bayesian_Computation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/astroml_logo.gif" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/astroml_logo.gif" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/astroML/astroML-notebooks" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter1/README.html">Chapter 1: Introduction and Data Sets</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter2/README.html">Chapter 2: Fast Computation and Massive Datasets</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter3/README.html">Chapter 3: Probability and Statistical Distributions</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/astroml_chapter3_Overview_of_Probability_and_Random_Variables.html">Overview of Probability and Random Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/astroml_chapter3_Descriptive_Statistics.html">Descriptive Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/astroml_chapter3_Univariate_Distribution_Functions.html">Univariate Distribution Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/astroml_chapter3_The_Central_Limit_Theorem.html">The Central Limit Theorem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/astroml_chapter3_Bivariate_and_Multivariate_Distribution_Functions.html">Bivariate and multivariate distribution functions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter4/README.html">Chapter 4: Classical Statistical Inference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/astroml_chapter4_Maximum_Likelihood_Estimation_and_Goodness_of_fit.html">Maximum Likelihood Estimation (MLE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/astroml_chapter4_Gaussian_mixtures.html">MLE applied to Gaussian mixtures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/astroml_chapter4_Confidence_estimates.html">Confidence Estimates: The Bootstrap and The Jackknife</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/astroml_chapter4_Hypothesis_testing.html">Hypothesis Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/astroml_chapter4_Comparison_of_distributions.html">Comparison of distributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/astroml_chapter4_Nonparametric_modeling_and_selection_effects.html">Nonparametric modeling and selection effects</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="README.html">Chapter 5: Bayesian Statistical Inference</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="astroml_chapter5_Parameter_Estimation_for_Gaussian_Distribution.html">Parameter Estimation for a Gaussian Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="astroml_chapter5_Parameter_Estimation_for_Binomial_Distribution.html">Parameter Estimation for a Binomial Distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="astroml_chapter5_Parameter_Estimation_for_Cauchy_Distribution.html">Parameter estimation for the Cauchy (Lorentzian) distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="astroml_chapter5_Approximate_Bayesian_Computation.html">Approximate Bayesian Computation Example</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Hierarchical Bayes Example</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter6/README.html">Chapter 6: Searching for Structure in Point Data</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter6/astroml_chapter6_Density_Estimation_for_SDSS_Great_Wall.html">Density Estimation for SDSS “Great Wall”</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter6/astroml_chapter6_Searching_for_Structure_in_Point_Data.html">Searching for Structure in Point Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter6/astroml_chapter6_Gaussian_Mixture_Models.html">Gaussian Mixture Models Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter6/astroml_chapter6_Extreme_Deconvolution.html">Extreme Deconvolution</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter7/README.html">Chapter 7: Dimensionality and its Reduction</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter7/astroml_chapter7_Dimensionality_Reduction.html">Dimensionality reduction</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter8/README.html">Chapter 8: Regression and Model Fitting</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter8/astroml_chapter8_Regression.html">Measurement Errors in Linear Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter8/astroml_chapter8_Regression_with_Errors_on_Dependent_and_Independent_Variables.html">Measurement errors in both dependent and independent variables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter9/README.html">Chapter 9: Classification</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter9/astroml_chapter9_Classification.html">Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter9/astroml_chapter9_Deep_Learning_Classifying_Astronomical_Images.html">Deep Learning: Classifying Astronomical Images</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter10/README.html">Chapter 10: Time Series Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter10/astroml_chapter10_Modeling_Toolkit_for_Time_Series_Analysis.html">Modeling Toolkit For Time Series Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter10/astroml_chapter10_Wavelets.html">Wavelets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter10/astroml_chapter10_Digital_Filtering.html">Digital Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter10/astroml_chapter10_Temporally_Localized_Signals.html">Temporally localized signals</a></li>

<li class="toctree-l2"><a class="reference internal" href="../chapter10/astroml_chapter10_Analysis_of_Stochastic_Processes.html">Analysis of Stochastic Processes</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/astroML/astroML-notebooks/main?urlpath=tree/chapter5/astroml_chapter5_Hierarchical_Bayes.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/astroML/astroML-notebooks/blob/main/chapter5/astroml_chapter5_Hierarchical_Bayes.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/astroML/astroML-notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astroML/astroML-notebooks/edit/main/chapter5/astroml_chapter5_Hierarchical_Bayes.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/astroML/astroML-notebooks/issues/new?title=Issue%20on%20page%20%2Fchapter5/astroml_chapter5_Hierarchical_Bayes.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter5/astroml_chapter5_Hierarchical_Bayes.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Hierarchical Bayes Example</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#january-6-2020">January 6, 2020</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-for-this-notebook-include">Resources for this notebook include:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#highly-recommended-supplemental-background-reading">Highly recommended supplemental background reading:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-those-who-want-to-dive-deep">For those who want to dive deep:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-bayes-modeling">Hierarchical Bayes Modeling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-case-of-gaussian-prior-and-likelihood">Simple case of Gaussian prior and likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Simple case of Gaussian prior and likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Simple case of Gaussian prior and likelihood</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-now-assume-we-have-n-measurements-data-points">Let’s now assume we have N measurements (data points)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-parameters-of-a-gaussian-distribution-using-data-with-homoscedastic-gaussian-uncertainties">Estimating parameters of a Gaussian distribution using data with homoscedastic Gaussian uncertainties</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Let’s now assume we have N measurements (data points)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Estimating parameters of a Gaussian distribution using data with homoscedastic Gaussian uncertainties</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#here-is-another-relatively-simple-case-to-bring-us-closer-to-the-main-idea-of-hierarchical-bayes">Here is another relatively simple case to bring us closer to the main idea of Hierarchical Bayes:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-parameters-of-a-gaussian-distribution-using-data-with-heteroscedastic-gaussian-uncertainties">Estimating parameters of a Gaussian distribution using data with heteroscedastic Gaussian uncertainties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Estimating parameters of a Gaussian distribution using data with heteroscedastic Gaussian uncertainties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-astrophysical-example-radial-velocity-dispersion-for-a-cluster">An astrophysical example: radial velocity dispersion for a cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">An astrophysical example: radial velocity dispersion for a cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">An astrophysical example: radial velocity dispersion for a cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-bayes">Hierarchical Bayes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Hierarchical Bayes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Discussion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="hierarchical-bayes-example">
<h1>Hierarchical Bayes Example<a class="headerlink" href="#hierarchical-bayes-example" title="Permalink to this headline">#</a></h1>
<section id="january-6-2020">
<h2>January 6, 2020<a class="headerlink" href="#january-6-2020" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="http://www.astroml.org/workshops/AAS235.html">astroML workshop at the 235th Meeting of the American Astronomical Society</a></p>
<p><a class="reference external" href="http://faculty.washington.edu/ivezic/">Zeljko Ivezic, University of Washington</a></p>
<p><a class="reference external" href="https://github.com/astroML/astroML-workshop_AAS235/blob/master/bayesian/AAS2019_HBexample.ipynb">This notebook</a></p>
<section id="resources-for-this-notebook-include">
<h3>Resources for this notebook include:<a class="headerlink" href="#resources-for-this-notebook-include" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="http://press.princeton.edu/titles/10159.html">Textbook</a> Chapter 5.</p></li>
<li><p><a class="reference external" href="https://github.com/jakevdp/BayesianAstronomy">Jake VanderPlas’ workshop “Bayesian Astronomy”</a></p></li>
<li><p><a class="reference external" href="http://jakevdp.github.io/blog/2014/03/11/frequentism-and-bayesianism-a-practical-intro/">Jake VanderPlas’ blog “Frequentism and Bayesianism: A Practical Introduction”</a></p></li>
</ul>
</section>
<section id="highly-recommended-supplemental-background-reading">
<h3>Highly recommended supplemental background reading:<a class="headerlink" href="#highly-recommended-supplemental-background-reading" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/LSSTC-DSFP/LSSTC-DSFP-Sessions/tree/master/Session4/Day1">Mario Juric: Frequentist vs. Bayesian Perspectives (LSSTC Data Science Fellowship Program Lecture)</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/1411.5018">Jake VanderPlas: ``Frequentism and Bayesianism: A Python-driven Primer”</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/abs/1008.4686">Hogg, Bovy and Lang: ``Data analysis recipes: Fitting a model to data”</a></p></li>
</ul>
</section>
<section id="for-those-who-want-to-dive-deep">
<h3>For those who want to dive deep:<a class="headerlink" href="#for-those-who-want-to-dive-deep" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.amazon.com/Data-Analysis-Bayesian-Devinderjit-Sivia/dp/0198568320">D. Sivia and J. Skilling: ``Data Analysis: A Bayesian Tutorial’’</a></p></li>
<li><p><a class="reference external" href="http://bayes.wustl.edu/etj/prob/book.pdf">E.T. Jaynes: ``Probability Theory: The Logic of Science’’</a></p></li>
<li><p><a class="reference external" href="http://bayes.wustl.edu/etj/articles/confidence.pdf">E.T. Jaynes: ``Confidence Intervals vs. Bayesian intervals’’</a></p></li>
</ul>
</section>
</section>
<section id="hierarchical-bayes-modeling">
<h2>Hierarchical Bayes Modeling<a class="headerlink" href="#hierarchical-bayes-modeling" title="Permalink to this headline">#</a></h2>
<p>(a.k.a. multilevel models, Bayesian belief networks, or graphical models)</p>
<p>We’ll start with a quick reminder of Bayes’ Theorem and its implications for today’s discussion</p>
<p><img alt="Bayesian Statistics" src="../_images/bayes2.jpg" /></p>
<section id="simple-case-of-gaussian-prior-and-likelihood">
<h3>Simple case of Gaussian prior and likelihood<a class="headerlink" href="#simple-case-of-gaussian-prior-and-likelihood" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><p><em><strong>Bayes’ Theorem:</strong></em> $<span class="math notranslate nohighlight">\(p(M|D) = \frac{p(D|M)p(M)}{p(D)} \)</span>$</p>
</div></blockquote>
<p>Let’s assume a one-dimensional problem: we measure length (or mass, or velocity, or metallicity, or …) <span class="math notranslate nohighlight">\(x\)</span>, with measurement uncertainty <span class="math notranslate nohighlight">\(e\)</span>, and we are trying to estimate <span class="math notranslate nohighlight">\(\mu\)</span>, the true length.</p>
<p>We have prior information (belief) for the value of <span class="math notranslate nohighlight">\(\mu\)</span> that can be summarized as N(<span class="math notranslate nohighlight">\(\mu_0\)</span>, <span class="math notranslate nohighlight">\(\sigma_0\)</span>). For example, this could be the result of a number of older (prior) measurements.</p>
</section>
<section id="id1">
<h3>Simple case of Gaussian prior and likelihood<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<blockquote>
<div><p><em><strong>Bayes’ Theorem:</strong></em> $<span class="math notranslate nohighlight">\(p(M|D) = \frac{p(D|M)p(M)}{p(D)} \)</span>$</p>
</div></blockquote>
<p>The posterior probability density function is then</p>
<div class="math notranslate nohighlight">
\[ p(\mu | x, e, \mu_0, \sigma_0) \propto \frac{1}{e\sqrt{2\pi}} \exp\left(\frac{-(\mu - x)^2}{2e^2}\right) \times\]</div>
<div class="math notranslate nohighlight">
\[ \frac{1}{\sigma_0\sqrt{2\pi}} \exp\left(\frac{-(\mu - \mu_0)^2}{2 \sigma_0^2}\right).\]</div>
<p>When the posterior probability density function is a product of two Gaussians,
it is easy to show that <span class="math notranslate nohighlight">\( p(\mu | x, e, \mu_0, \sigma_0)\)</span> can be summarized as a Gaussian
$<span class="math notranslate nohighlight">\( p(\mu | x, e, \mu_0, \sigma_0) = \frac{1}{\sigma_p\sqrt{2\pi}} \exp\left(\frac{-(\mu - \mu_p)^2}{2\sigma_p^2}\right),\)</span>$</p>
<p>with
$<span class="math notranslate nohighlight">\(\mu_p = \frac{(x/e^2) + (\mu_0/\sigma_0^2)}{1/e^2 + 1/\sigma_0^2}  \)</span><span class="math notranslate nohighlight">\(
and 
\)</span><span class="math notranslate nohighlight">\( \sigma_p = \left( 1/e^2 + 1/\sigma_0^2 \right)^{-1/2}\)</span>$</p>
</section>
<section id="id2">
<h3>Simple case of Gaussian prior and likelihood<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<p>This result, where <span class="math notranslate nohighlight">\(\mu_p\)</span> is obtained by inverse variance weighting,
$<span class="math notranslate nohighlight">\(\mu_p = \frac{(x/e^2) + (\mu_0/\sigma_0^2)}{1/e^2 + 1/\sigma_0^2} \,\,\,\, {\rm and} \,\,\,\, \sigma_p = \left( 1/e^2 + 1/\sigma_0^2 \right)^{-1/2}\)</span>$
is quite simple, but very educational. Let’s plot an example…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## case of conjugate prior: both prior and posterior pdfs are gaussian</span>
<span class="n">x</span> <span class="o">=</span> <span class="mf">0.7</span> 
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mf">1.4</span>
<span class="n">sigma0</span> <span class="o">=</span> <span class="mf">0.3</span> 
<span class="n">muGrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">muGrid</span><span class="p">)</span> 
<span class="n">n2</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">mu0</span><span class="p">,</span> <span class="n">sigma0</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">muGrid</span><span class="p">)</span> 
<span class="n">P</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">*</span> <span class="n">n2</span> 
<span class="c1"># need to properly normalize P to make it pdf </span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">simps</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">/</span><span class="n">simps</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">muGrid</span><span class="p">)</span>

<span class="c1"># for fun, compute mu_p and sigma_p and compare to direct multiplication of n1 and n2</span>
<span class="n">sigma_p</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">sigma0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mu_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mu0</span><span class="o">/</span><span class="n">sigma0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sigma_p</span><span class="o">**</span><span class="mi">2</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">mu_p</span><span class="p">,</span> <span class="n">sigma_p</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">muGrid</span><span class="p">)</span> 

<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muGrid</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;measurement&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muGrid</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;prior&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muGrid</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;direct product&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">muGrid</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;posterior&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\mu$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(x_i|\mu,\sigma)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian prior and Gaussian Likelihood&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9efda439f1b61a32ee4521cd1ddeb3d6e2b30aa5bba121d4ae22ace8cd7808ba.png" src="../_images/9efda439f1b61a32ee4521cd1ddeb3d6e2b30aa5bba121d4ae22ace8cd7808ba.png" />
</div>
</div>
<ul class="simple">
<li><p>The posterior pdf is <em><strong>narrower</strong></em> than both measurement pdf (i.e. likelihood) and prior pdf (recall that measurement precision often scales as <span class="math notranslate nohighlight">\(1/\sqrt{N}\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is the number of data points)</p></li>
<li><p>The posterior pdf is <em><strong>biased</strong></em> compared to the maximum likelihood estimate!</p></li>
<li><p>In this example, the likelihood and prior pdfs can be switched and the posterior pdf will remain unchanged</p></li>
<li><p>The same posterior pdf is the solution when prior is based on <span class="math notranslate nohighlight">\(N-1\)</span> data points and likelihood corresponds to the <span class="math notranslate nohighlight">\(N\)</span>th data point: an online algorithm!</p></li>
</ul>
<section id="let-s-now-assume-we-have-n-measurements-data-points">
<h4>Let’s now assume we have N measurements (data points)<a class="headerlink" href="#let-s-now-assume-we-have-n-measurements-data-points" title="Permalink to this headline">#</a></h4>
</section>
</section>
<section id="estimating-parameters-of-a-gaussian-distribution-using-data-with-homoscedastic-gaussian-uncertainties">
<h3>Estimating parameters of a Gaussian distribution using data with homoscedastic Gaussian uncertainties<a class="headerlink" href="#estimating-parameters-of-a-gaussian-distribution-using-data-with-homoscedastic-gaussian-uncertainties" title="Permalink to this headline">#</a></h3>
<p>The data likelihood can be written as:</p>
<div class="math notranslate nohighlight">
\[  p(\{x_i\}|\mu,\sigma,I) = \prod_{i=1}^N  {1 \over \sqrt{2\pi} (\sigma^2+e^2)^{1/2}}
                   \exp{\left({-(x_i-\mu)^2 \over 2 (\sigma^2+e^2)}\right)}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> can still describe the prior pdf (after rearragning to posterior pdf
via Bayes’ theorem). But we can also interpret <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> as describing an additional
(part of the) process that generates data, and that are themselves drawn from flat priors - math
is exactly the same.</p>
<section id="id3">
<h4>Let’s now assume we have N measurements (data points)<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
</section>
</section>
<section id="id4">
<h3>Estimating parameters of a Gaussian distribution using data with homoscedastic Gaussian uncertainties<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<p>The posterior pdf for <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> is:</p>
<div class="math notranslate nohighlight">
\[  p(\mu,\sigma | \{x_i\},I) = \prod_{i=1}^N  {1 \over \sqrt{2\pi} (\sigma^2+e^2)^{1/2}}
                   \exp{\left({-(x_i-\mu)^2 \over 2 (\sigma^2+e^2)}\right)}\]</div>
<p>Because errors are homoscedastic (all data points have uncertainty <span class="math notranslate nohighlight">\(e\)</span>), there is a
closed-form solution. For example, we can estimate <span class="math notranslate nohighlight">\(\sigma^2\)</span> by subtracting <span class="math notranslate nohighlight">\(e^2\)</span> from
the variance of <span class="math notranslate nohighlight">\(\{x_i\}\)</span> (i.e. if <span class="math notranslate nohighlight">\(\sigma=0\)</span>, the width of <span class="math notranslate nohighlight">\(\{x_i\}\)</span> distribution would be simply <span class="math notranslate nohighlight">\(e\)</span>).</p>
<section id="here-is-another-relatively-simple-case-to-bring-us-closer-to-the-main-idea-of-hierarchical-bayes">
<h4>Here is another relatively simple case to bring us closer to the main idea of Hierarchical Bayes:<a class="headerlink" href="#here-is-another-relatively-simple-case-to-bring-us-closer-to-the-main-idea-of-hierarchical-bayes" title="Permalink to this headline">#</a></h4>
</section>
</section>
<section id="estimating-parameters-of-a-gaussian-distribution-using-data-with-heteroscedastic-gaussian-uncertainties">
<h3>Estimating parameters of a Gaussian distribution using data with heteroscedastic Gaussian uncertainties<a class="headerlink" href="#estimating-parameters-of-a-gaussian-distribution-using-data-with-heteroscedastic-gaussian-uncertainties" title="Permalink to this headline">#</a></h3>
<p>The posterior pdf for <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> is:<br />
$<span class="math notranslate nohighlight">\(  p(\mu,\sigma | \{x_i\},I) = \prod_{i=1}^N  {1 \over \sqrt{2\pi} (\sigma^2+e_i^2)^{1/2}}
                   \exp{\left({-(x_i-\mu)^2 \over 2 (\sigma^2+e_i^2)}\right)}\)</span>$</p>
<p>There is no closed-form solution here because errors are heteroscedastic (each data point
has a different uncertainty <span class="math notranslate nohighlight">\(e_i\)</span>), but we can easily evaluate posterior pdf (say, with uniform priors)
on a grid of <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> (or use more sophisticated methods such as MCMC).</p>
</section>
<section id="id5">
<h3>Estimating parameters of a Gaussian distribution using data with heteroscedastic Gaussian uncertainties<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>The posterior pdf for <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> is:<br />
$<span class="math notranslate nohighlight">\(  p(\mu,\sigma | \{x_i\},I) = \prod_{i=1}^N  {1 \over \sqrt{2\pi} (\sigma^2+e_i^2)^{1/2}}
                   \exp{\left({-(x_i-\mu)^2 \over 2 (\sigma^2+e_i^2)}\right)}\)</span>$</p>
<p>There is no closed-form solution here because errors are heteroscedastic (each data point
has a different uncertainty <span class="math notranslate nohighlight">\(e_i\)</span>), but we can easily evaluate posterior pdf (say, with uniform priors)
on a grid of <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> (or use more sophisticated methods such as MCMC).</p>
<p>The key point is that the scatter of <span class="math notranslate nohighlight">\(\{x_i\}\)</span> is larger than it would be for <span class="math notranslate nohighlight">\(\sigma=0\)</span> (that is, <span class="math notranslate nohighlight">\(\chi^2&gt;1\)</span>)
and thus it constrains <span class="math notranslate nohighlight">\(\sigma\)</span>.</p>
</section>
<section id="an-astrophysical-example-radial-velocity-dispersion-for-a-cluster">
<h3>An astrophysical example: radial velocity dispersion for a cluster<a class="headerlink" href="#an-astrophysical-example-radial-velocity-dispersion-for-a-cluster" title="Permalink to this headline">#</a></h3>
<p>Consider measurements of the radial velocities of <span class="math notranslate nohighlight">\(N\)</span> stars from a stellar or
galaxy cluster.</p>
<p>Assume that the cluster radial velocity distribution can be
fully characterized by its mean, the systemic velocity (because the whole
cluster is moving relative to the observer), and its standard deviation,
the cluster velocity dispersion (because objects are gravitationally tied to
the cluster and have orbital motions).</p>
</section>
<section id="id6">
<h3>An astrophysical example: radial velocity dispersion for a cluster<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<p>Consider measurements of the radial velocities of <span class="math notranslate nohighlight">\(N\)</span> stars from a stellar or
galaxy cluster.</p>
<p>The observed dispersion (i.e. standard deviation) of measured velocities
is always larger than the cluster velocity dispersion because of measurement
errors.</p>
<p>When measurement errors are homoscedastic, we can estimate the cluster velocity
dispersion, by subtracting the measurement error contribution from the observed
dispersion (i.e. standard deviation) of measured velocities.</p>
</section>
<section id="id7">
<h3>An astrophysical example: radial velocity dispersion for a cluster<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h3>
<p>When errors are heteroscedastic, we don’t have a closed-form solution.</p>
<p>We can assume that the true radial velocity of a single object is drawn
from a Gaussian described by <span class="math notranslate nohighlight">\(\mu\)</span> (systemic velocity) and <span class="math notranslate nohighlight">\(\sigma\)</span> (velocity
dispersion). But we don’t know them and thus they need to be estimated from data!</p>
<p>In case of many objects, they will collectively constrain <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span>.
Many independent measurement sets (here a set of one measurement per object)
that share same priors constrain them better together than can any single
measurement alone. This is the key idea of Hierarchical Bayes modeling.</p>
</section>
<section id="hierarchical-bayes">
<h3>Hierarchical Bayes<a class="headerlink" href="#hierarchical-bayes" title="Permalink to this headline">#</a></h3>
<p>In hierarchical, or multilevel, Bayesian analysis a prior distribution depends
on unknown variables, the hyperparameters, that describe the group (population)
level probabilistic model.</p>
<p>Their priors, called hyperpriors, resemble the priors in simple (single-level)
Bayesian models.</p>
<p>In the radial velocity example above, <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> are priors, and their
corresponding prior distributions (assumed flat below), are hyperpriors.</p>
</section>
<section id="id8">
<h3>Hierarchical Bayes<a class="headerlink" href="#id8" title="Permalink to this headline">#</a></h3>
<p>In hierarchical, or multilevel, Bayesian analysis a prior distribution depends
on unknown variables, the hyperparameters, that describe the group (population)
level probabilistic model.</p>
<p>When there are many independent measurement sets that share same priors, they together constrain priors better than can any single measurement alone.</p>
<p>In statistics, this effect is known as borrowing strength and is related to
the concept of shrinkage estimators.</p>
<p>Let’s now look at our radial velocity example numerically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">astroML.plotting.mcmc</span> <span class="kn">import</span> <span class="n">convert_to_stdev</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gaussgauss_logL</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">ei</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Equation 5.63: gaussian likelihood with gaussian errors&quot;&quot;&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">xi</span> <span class="o">=</span> <span class="n">xi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ndim</span> <span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ei</span> <span class="o">=</span> <span class="n">ei</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ei</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ndim</span> <span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">s2_e2</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ei</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s2_e2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">s2_e2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">getExpStD</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;given p(x), compute expectation value and std. dev.&quot;&quot;&quot;</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">Sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">Ex</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span>  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Sx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------------------------------------------------------------</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="c1"># for repeatability</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>               <span class="c1"># number of measured stars</span>
<span class="n">mu_true</span> <span class="o">=</span> <span class="o">-</span><span class="mf">50.0</span>      <span class="c1"># km/s, true systemic velocity</span>
<span class="n">sigma_true</span> <span class="o">=</span> <span class="mf">20.0</span>    <span class="c1"># km/s, true velocity dispersion</span>
<span class="n">ei</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>   <span class="c1"># n.b. heteroscedastic errors</span>
<span class="c1"># generate measurements</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mu_true</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_true</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ei</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">wi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">ei</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">ei</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># weighted mean</span>
<span class="n">wmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wi</span> <span class="o">*</span> <span class="n">xi</span><span class="p">)</span>
<span class="c1"># uncertainty of weighted mean</span>
<span class="n">wmeane</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">ei</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># other stats</span>
<span class="n">medvel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<span class="n">meanvel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<span class="n">velstd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>

<span class="c1"># define the grids and compute logL</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>

<span class="n">logL</span> <span class="o">=</span> <span class="n">gaussgauss_logL</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">ei</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<span class="n">logL</span> <span class="o">-=</span> <span class="n">logL</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logL</span><span class="p">)</span>

<span class="c1"># integrate L to get marginal prob. distributions</span>
<span class="n">p_sigma</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p_sigma</span> <span class="o">/=</span> <span class="p">(</span><span class="n">sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">p_sigma</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">p_mu</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">p_mu</span> <span class="o">/=</span> <span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">p_mu</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#------------------------------------------------------------</span>
<span class="kn">from</span> <span class="nn">astroML.plotting</span> <span class="kn">import</span> <span class="n">setup_text_plots</span>
<span class="n">setup_text_plots</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># plot the results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.24</span><span class="p">,</span>
                    <span class="n">bottom</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">logL</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
           <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">mu</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
           <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
           <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log(L)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">convert_to_stdev</span><span class="p">(</span><span class="n">logL</span><span class="p">),</span>
            <span class="n">levels</span><span class="o">=</span><span class="p">(</span><span class="mf">0.683</span><span class="p">,</span> <span class="mf">0.955</span><span class="p">,</span> <span class="mf">0.997</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;${\rm systemic \, velocity \, } v_s \, {\rm (km/s)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;${\rm intrinsic \, vel. \, dispersion \,} \sigma \, {\rm (km/s)}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># plot true values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mu_true</span><span class="p">,</span> <span class="n">mu_true</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;:r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="n">sigma_true</span><span class="p">,</span> <span class="n">sigma_true</span><span class="p">],</span> <span class="s1">&#39;:r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># second axis: marginalized over mu</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p_mu</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_s$ (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(v_s)$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">)</span>
<span class="c1"># mark expectation value for radial velocity</span>
<span class="n">Ev</span><span class="p">,</span> <span class="n">Sv</span> <span class="o">=</span> <span class="n">getExpStD</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">p_mu</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">Ev</span><span class="p">,</span> <span class="n">Ev</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># mark true systemic velocity and weighted mean of data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mu_true</span><span class="p">,</span> <span class="n">mu_true</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;:r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">wmean</span><span class="p">,</span> <span class="n">wmean</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;--b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot the marginalized distribution for sigma</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">p_sigma</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma$ (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(\sigma)$&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">sigma_true</span><span class="p">,</span> <span class="n">sigma_true</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;:r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ed</span><span class="p">,</span> <span class="n">Sd</span> <span class="o">=</span> <span class="n">getExpStD</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">p_sigma</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">Ed</span><span class="p">,</span> <span class="n">Ed</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot data</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">((</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">))</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{obs}</span><span class="s1">$ (km/s)&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;measurement index&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">150</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="c1"># mark +-error ranges</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">xL</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ei</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">xR</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ei</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xL</span><span class="p">,</span> <span class="n">xR</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># mark true systemic velocity and weighted mean of data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">wmean</span><span class="p">,</span> <span class="n">wmean</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;--b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mu_true</span><span class="p">,</span> <span class="n">mu_true</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;:r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># mark posterior range for each star</span>
<span class="n">mup</span> <span class="o">=</span> <span class="n">Ev</span>
<span class="n">sigp</span> <span class="o">=</span> <span class="n">Ed</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">sig0</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sigp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">ei</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="p">(</span><span class="n">mup</span> <span class="o">/</span> <span class="n">sigp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">ei</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">xL</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">-</span> <span class="n">sig0</span>
    <span class="n">xR</span> <span class="o">=</span> <span class="n">mu0</span> <span class="o">+</span> <span class="n">sig0</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xL</span><span class="p">,</span> <span class="n">xR</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># and expectation value for systemic velocity</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mup</span><span class="p">,</span> <span class="n">mup</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d2be97f8b3b179d32a75ca3378e39d4abe2e1b617c33c7c837e0d370aeb495e5.png" src="../_images/d2be97f8b3b179d32a75ca3378e39d4abe2e1b617c33c7c837e0d370aeb495e5.png" />
</div>
</div>
</section>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">#</a></h2>
<p>In this particular example, the cluster velocity dispersion is astrophysically the most interesting quantity, while the posterior constraints on radial velocities for individual stars are less important.</p>
<p>However, in other settings described by the same mathematical model the posterior pdfs for the individually measured quantities (i.e., the true radial velocity for each star in the above example) may be of more interest than the priors. In such cases the posterior pdf is marginalized over the priors.</p>
<p>An approximate shortcut approach is to fix the priors at their most probable or expectation values. This method is known as empirical Bayes.</p>
<p>Note that the posterior estimates of true velocities are biased relative to ML estimates,
and have <em>smaller</em> uncertainies (hence the name shrinkage) than their measurement uncertainties!</p>
</section>
<section id="id9">
<h2>Discussion<a class="headerlink" href="#id9" title="Permalink to this headline">#</a></h2>
<p>Recently, HB modeling has become an increasingly popular subfield of astrostatistics.</p>
<p>HB modeling in astronomy is often applied to a set of sets of measurements that have
something in common, such as measurements of individual phenomena that come from the
same population (c.f. the above radial velocity example).</p>
<p>Good examples include measurements of faint sources that share the same background, of individual supernova luminosities
drawn from a population of cosmological type Ia supernovae, estimates of spectral energy
distribution of stars that are all behind the same dust layer with unknown extinction
properties, and estimates of planetary orbital eccentricity distribution.</p>
</section>
<section id="id10">
<h2>Discussion<a class="headerlink" href="#id10" title="Permalink to this headline">#</a></h2>
<p>Another very important application of HB modeling, that is becoming more common, is
accounting for measurement errors, intrinsic variance across a population, and various
astronomical selection effects; a rather complex modeling framework is discussed in detail
in a landmark study by Kelly et al. 2007 (ApJ 665, 1489).</p>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="astroml_chapter5_Approximate_Bayesian_Computation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Approximate Bayesian Computation Example</p>
      </div>
    </a>
    <a class="right-next"
       href="../chapter6/README.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 6: Searching for Structure in Point Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#january-6-2020">January 6, 2020</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-for-this-notebook-include">Resources for this notebook include:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#highly-recommended-supplemental-background-reading">Highly recommended supplemental background reading:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#for-those-who-want-to-dive-deep">For those who want to dive deep:</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-bayes-modeling">Hierarchical Bayes Modeling</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-case-of-gaussian-prior-and-likelihood">Simple case of Gaussian prior and likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Simple case of Gaussian prior and likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Simple case of Gaussian prior and likelihood</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-now-assume-we-have-n-measurements-data-points">Let’s now assume we have N measurements (data points)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-parameters-of-a-gaussian-distribution-using-data-with-homoscedastic-gaussian-uncertainties">Estimating parameters of a Gaussian distribution using data with homoscedastic Gaussian uncertainties</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Let’s now assume we have N measurements (data points)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Estimating parameters of a Gaussian distribution using data with homoscedastic Gaussian uncertainties</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#here-is-another-relatively-simple-case-to-bring-us-closer-to-the-main-idea-of-hierarchical-bayes">Here is another relatively simple case to bring us closer to the main idea of Hierarchical Bayes:</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-parameters-of-a-gaussian-distribution-using-data-with-heteroscedastic-gaussian-uncertainties">Estimating parameters of a Gaussian distribution using data with heteroscedastic Gaussian uncertainties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Estimating parameters of a Gaussian distribution using data with heteroscedastic Gaussian uncertainties</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#an-astrophysical-example-radial-velocity-dispersion-for-a-cluster">An astrophysical example: radial velocity dispersion for a cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">An astrophysical example: radial velocity dispersion for a cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">An astrophysical example: radial velocity dispersion for a cluster</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-bayes">Hierarchical Bayes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Hierarchical Bayes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Discussion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By AstroML developers
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2020-2022, AstroML developers.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>